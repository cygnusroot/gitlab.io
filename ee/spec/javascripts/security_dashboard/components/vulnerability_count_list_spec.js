import Vue from 'vue';
import Vuex from 'vuex';
import component from 'ee/security_dashboard/components/vulnerability_count_list.vue';
import state from 'ee/security_dashboard/store/modules/vulnerabilities/state';
import { mountComponentWithStore } from 'spec/helpers/vue_mount_component_helper';

describe('Vulnerability Count List', () => {
  const Component = Vue.extend(component);
  const ultimateAnswer = 42;
  const getters = {
    vulnerabilitiesCountBySeverity: () => () => ultimateAnswer,
  };
  const store = new Vuex.Store({
    modules: {
      vulnerabilities: {
        namespaced: true,
        state: state(),
        getters,
      },
    },
  });
  let vm;

  beforeEach(() => {
    vm = mountComponentWithStore(Component, { store });
  });

  afterEach(() => {
    vm.$destroy();
  });

  it('should fetch the counts for each severity', () => {
    expect(vm.counts[0].count).toEqual(ultimateAnswer);
    expect(vm.counts[vm.counts.length - 1].count).toEqual(ultimateAnswer);
  });

  it('should render a counter for each severity', () => {
    expect(vm.$el.querySelectorAll('.js-count')).toHaveLength(vm.counts.length);
  });
});
